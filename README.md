# 🍅 항상 떠있는 뽀모도로

> macOS 전용 메뉴바 + 플로팅 윈도우 뽀모도로 타이머

![Swift](https://img.shields.io/badge/Swift-5.9-orange.svg)
![macOS](https://img.shields.io/badge/macOS-13.0+-blue.svg)
![License](https://img.shields.io/badge/License-Personal-green.svg)

## 🎯 주요 기능

### ⚡️ 핵심 기능
- **📋 메뉴바 타이머**: 상태와 남은 시간을 메뉴바에 실시간 표시
- **🔲 Always-on-Top 윈도우**: 항상 위에 떠있는 드래그 가능한 미니 타이머
- **⏰ 정확한 시간 계산**: 시각 기반 계산으로 슬립 모드에서도 정확
- **🔄 자동 세션 전환**: 집중 → 휴식 → 롱브레이크 자동 순환

### 🎮 편의 기능
- **⌨️ 글로벌 단축키**: 어느 앱에서나 타이머 조작 가능
  - `⌥ + ⌘ + S`: 시작/일시정지
  - `⌥ + ⌘ + →`: 건너뛰기
  - `⌥ + ⌘ + R`: 리셋
- **🔔 네이티브 알림**: macOS 알림센터 통합
- **💤 슬립 복원**: 맥북 절전 모드 후에도 정확한 시간 복원
- **⚙️ 커스터마이징**: 집중/휴식 시간, 자동 시작 등 설정 가능

## 📊 시각적 특징

### 🎨 색상 구분
- 🔴 **집중 모드** (기본 25분)
- 🟢 **짧은 휴식** (기본 5분)  
- 🔵 **긴 휴식** (기본 15분, 4사이클 후)
- ⚪️ **준비/정지 상태**

### 💫 UI 요소
- **원형 프로그레스 바**: 남은 시간 시각화
- **실시간 카운트다운**: 메뉴바 + 플로팅 윈도우
- **다크모드 지원**: 시스템 테마 자동 적용
- **한국어 인터페이스**: 완전한 한국어 지원

## 🏗️ 아키텍처

```
📁 Pomodoro/
├── 🎯 PomodoroApp.swift          # 앱 진입점 & 환경 설정
├── ⚙️ Services/
│   ├── TimerService.swift        # 핵심 타이머 로직 & 상태 관리
│   ├── NotificationService.swift # macOS 알림 처리
│   └── HotkeyService.swift       # 글로벌 단축키 등록
├── 🖼️ Views/
│   ├── MenuBarController.swift   # 메뉴바 아이콘 & 드롭다운
│   └── MiniTimerWindow.swift     # 플로팅 타이머 윈도우 + 설정
└── 📊 Models/
    └── SessionStore.swift        # 설정 저장 & 슬립 감지
```

### 🔧 핵심 서비스

#### TimerService
- **정확한 시간 계산**: `Date` 기반 종료 시점 계산
- **DispatchSourceTimer**: 100ms 주기 UI 업데이트  
- **자동 모드 전환**: Focus → Break → Long Break 순환
- **슬립 모드 대응**: 시스템 깨어남 시 시간 재계산

#### NotificationService  
- **UNUserNotificationCenter**: 네이티브 알림
- **각 세션 완료 알림**: 집중 완료 → "휴식하세요", 휴식 완료 → "집중하세요"
- **조용 모드**: 전체화면 앱 실행 중 알림 최소화

#### HotkeyService
- **Carbon 프레임워크**: 시스템 레벨 단축키 등록
- **접근성 권한**: 글로벌 단축키 사용을 위한 시스템 권한 필요
- **충돌 방지**: 기존 시스템 단축키와 겹치지 않는 조합 선택

## 🚀 설치 & 실행

### 1. 개발 환경에서 실행
```bash
# 1. 저장소 클론
git clone [repository-url]
cd Pomodoro

# 2. Xcode로 열기
open Pomodoro.xcodeproj

# 3. 빌드 & 실행
# Xcode에서 ▶️ 버튼 클릭 또는 Cmd + R
```

### 2. 개인용 앱으로 설치
```bash
# 1. Archive 빌드
# Xcode → Product → Archive → Distribute App → Copy App

# 2. Applications 폴더에 복사
cp -r Pomodoro.app /Applications/

# 3. 로그인 시 자동 실행 (선택사항)
# 시스템 설정 → 일반 → 로그인 항목 → Pomodoro 추가
```

### 3. 권한 설정
- **알림 권한**: 첫 실행 시 자동으로 요청
- **접근성 권한**: 글로벌 단축키 사용을 위해 필요
  - 시스템 설정 → 개인정보 보호 및 보안 → 접근성 → Pomodoro 체크

### ⚠️ 보안 경고 해결법 (중요!)

첫 실행시 **"악성코드 확인 불가"** 경고가 뜨는 것은 정상입니다!

**해결법**: 
1. `Pomodoro.app` **우클릭** → **"열기"** 선택
2. 경고 팝업에서 **"열기"** 클릭  
3. 정상 실행! 🎉

*개발자 서명이 없는 개인/팀용 앱에서 항상 나타나는 현상입니다.*

**대체 방법**: `시스템 설정` → `개인정보 보호 및 보안` → `보안` → `확인 없이 열기`

## 📋 사용법

### 기본 조작
1. **앱 실행** → 메뉴바에 `⚪️ 25:00` 표시 + 플로팅 윈도우 생성
2. **시작**: 플로팅 윈도우 ▶️ 버튼 또는 `⌥⌘S`
3. **일시정지**: ⏸️ 버튼 또는 다시 `⌥⌘S`
4. **건너뛰기**: ⏭️ 버튼 또는 `⌥⌘→`
5. **리셋**: ↶ 버튼 또는 `⌥⌘R`

### 설정 변경
- **메뉴바** 클릭 → **설정** 선택
- 또는 **플로팅 윈도우에서 우클릭** → 설정

### 뽀모도로 사이클
```
집중 25분 → 알림 → 짧은 휴식 5분 → 알림
    ↓ (4회 반복)
긴 휴식 15분 → 알림 → 처음부터 다시
```

## ⚙️ 설정 옵션

| 설정 | 기본값 | 범위 | 설명 |
|-----|-------|------|-----|
| 집중 시간 | 25분 | 1-180분 | 뽀모도로 집중 세션 길이 |
| 짧은 휴식 | 5분 | 1-60분 | 일반 휴식 시간 |
| 긴 휴식 | 15분 | 1-120분 | 여러 사이클 후 긴 휴식 |
| 긴 휴식까지 사이클 | 4회 | 1-12회 | 몇 번째 집중 후 긴 휴식할지 |
| 자동 시작 | ON | ON/OFF | 다음 세션 자동 시작 여부 |
| 전체화면 시 조용히 | ON | ON/OFF | 전체화면 앱 사용 중 알림 최소화 |

## 🛠️ 기술 스택

- **언어**: Swift 5.9+
- **프레임워크**: SwiftUI, AppKit, Combine
- **플랫폼**: macOS 13.0+  
- **아키텍처**: MVVM 패턴
- **상태관리**: `@ObservableObject` + Combine
- **데이터 저장**: UserDefaults (설정), Core Data (세션 로그)
- **타이머**: DispatchSourceTimer + Date 기반 정확도
- **알림**: UNUserNotificationCenter
- **단축키**: Carbon 프레임워크

## 🎯 성능 특징

- **⚡️ 경량**: 평균 CPU < 1%, 메모리 < 120MB
- **🔋 절전**: App Nap 최적화, 필요시에만 활성 상태 유지  
- **⏱️ 정확도**: 1시간 연속 실행 시 ±1초 이내 오차
- **💤 복원력**: 슬립/절전 모드 후 정확한 시간 복원

## 📝 개발 노트

### 설계 원칙
1. **개인용 최적화**: 복잡한 동기화나 서버 연동 없이 로컬 완결
2. **방해 최소화**: 알림과 UI를 최소한으로 유지
3. **정확성 우선**: 시각 기반 계산으로 타이머 드리프트 방지
4. **네이티브 통합**: macOS 시스템과 자연스럽게 통합

### 알려진 제한사항
- **샌드박스 미적용**: 글로벌 단축키를 위해 샌드박스 비활성화
- **서명 없음**: 개인용이므로 공식 개발자 서명 없음
- **자동 업데이트 없음**: 수동 업데이트 필요

## 📄 라이선스

개인 프로젝트 - 개인용으로만 사용하시기 바랍니다.

## 🤝 기여

개인용 프로젝트이지만 개선사항이나 버그 리포트는 언제나 환영합니다!

---

**💡 팁**: 이 앱은 "방해받지 않는 집중"을 위해 UI를 최대한 단순하게 만들었습니다. 복잡한 통계나 분석보다는 "지금 집중하기"에 최적화되어 있어요!